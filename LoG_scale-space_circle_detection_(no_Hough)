import cv2 as cv
import numpy as np
import matplotlib.pyplot as plt
from math import sqrt
from skimage.feature import blob_log


im = cv.imread('images/the_berry_farms_sunflower_field.jpeg', cv.IMREAD_REDUCED_COLOR_4)
gray = cv.cvtColor(im, cv.COLOR_BGR2GRAY)

min_sigma, max_sigma, num_sigma = 2, 40, 20
blobs = blob_log(gray, min_sigma=min_sigma, max_sigma=max_sigma,
                 num_sigma=num_sigma, threshold=0.1)


blobs[:, 2] = blobs[:, 2] * sqrt(2)


fig, ax = plt.subplots()
ax.imshow(gray, cmap='gray')
ax.set_axis_off()

for y, x, r in blobs:
    circ = plt.Circle((x, y), r, color='blue', linewidth=2, fill=False)
    ax.add_patch(circ)


largest = blobs[np.argmax(blobs[:, 2])]
print(f"Sigma range used: [{min_sigma}, {max_sigma}] with num_sigma={num_sigma}")
print(f"Largest circle center = ({largest[1]:.1f}, {largest[0]:.1f}), radius = {largest[2]:.2f} px")

plt.show()
